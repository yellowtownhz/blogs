<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Qwen3Guard的关键技术细节 - 黄镇的博客</title><meta name=Description content="这是一篇中文翻译。"><meta property="og:url" content="https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/"><meta property="og:site_name" content="黄镇的博客"><meta property="og:title" content="Qwen3Guard的关键技术细节"><meta property="og:description" content="这是一篇中文翻译。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-29T12:00:00+08:00"><meta property="article:modified_time" content="2025-09-29T23:33:02+08:00"><meta property="article:tag" content="Qwen"><meta property="og:image" content="https://yellowtownhz.github.io/blogs/posts/qwen3-guard/arch.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yellowtownhz.github.io/blogs/posts/qwen3-guard/arch.png"><meta name=twitter:title content="Qwen3Guard的关键技术细节"><meta name=twitter:description content="这是一篇中文翻译。"><meta name=twitter:site content="@https://twitter.com/yourname"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/><link rel=stylesheet href=/blogs/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Qwen3Guard的关键技术细节","inLanguage":"zh","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yellowtownhz.github.io\/blogs\/zh\/posts\/qwen3-guard\/"},"image":[{"@type":"ImageObject","url":"https:\/\/yellowtownhz.github.io\/blogs\/posts\/qwen3-guard\/arch.png","width":1203,"height":458}],"genre":"posts","keywords":"Qwen","wordcount":3331,"url":"https:\/\/yellowtownhz.github.io\/blogs\/zh\/posts\/qwen3-guard\/","datePublished":"2025-09-29T12:00:00+08:00","dateModified":"2025-09-29T23:33:02+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"黄镇"},"description":"这是一篇中文翻译。"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>const query=window.matchMedia("(prefers-color-scheme: dark)");function applyTheme(){let e=window.localStorage?.getItem("theme")||"auto",t=e==="dark"||e==="auto"&&query.matches;document.body.setAttribute("theme",t?"dark":"light"),document.body.setAttribute("cfg-theme",e)}applyTheme(),query.addEventListener("change",applyTheme)</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/blogs/zh/ title=黄镇的博客>My cool site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/zh/blogs/posts/>Posts </a><a class=menu-item href=/zh/blogs/tags/>Tags </a><a class=menu-item href=/zh/blogs/categories/>Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/blogs/posts/qwen3-guard/>English</option><option value=/blogs/zh/posts/qwen3-guard/ selected>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blogs/zh/ title=黄镇的博客>My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/zh/blogs/posts/ title>Posts</a><a class=menu-item href=/zh/blogs/tags/ title>Tags</a><a class=menu-item href=/zh/blogs/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/blogs/posts/qwen3-guard/>English</option><option value=/blogs/zh/posts/qwen3-guard/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Qwen3Guard的关键技术细节</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/blogs/zh/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>黄镇</a></span>&nbsp;<span class=post-category>included in <a href=/blogs/zh/categories/general/><i class="far fa-folder fa-fw" aria-hidden=true></i>General</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-09-29>2025-09-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3331 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;7 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/blogs/svg/loading.min.svg data-src=/blogs/posts/qwen3-guard/arch.png data-srcset="/blogs/posts/qwen3-guard/arch.png, /blogs/posts/qwen3-guard/arch.png 1.5x, /blogs/posts/qwen3-guard/arch.png 2x" data-sizes=auto alt=/blogs/posts/qwen3-guard/arch.png title=这是一篇中文翻译。></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#解决的关键问题>解决的关键问题</a></li><li><a href=#解决问题的关键操作>解决问题的关键操作</a></li><li><a href=#容易忽视的关键细节>容易忽视的关键细节</a></li><li><a href=#insight>Insight</a></li></ul></nav></div></div><div class=content id=content><h2 id=解决的关键问题>解决的关键问题</h2><p>技术报告中提到Qwen3Guard的一种应用是在强化学习用来提升内容的安全性。这一点很有兴趣，一方面Qwen3Guard是如何训练出来的，他的技术路线对于未来微调一个数据质量分类、语言风格分类、领域分类等各种专业小模型有很大的借鉴意义；另一方面，Qwen3Guard在RL中如何和policy模型配合，对于多模型的agent RL也有借鉴意义。</p><h2 id=解决问题的关键操作>解决问题的关键操作</h2><p>比较独特的一点是在模型最后一层有两个head，一个head（黄色）用来分类prompt的安全性，一个head（蓝色）用来<strong>逐token地</strong>分类response的安全性。response的分类head可以在出现危险回复的第一个token的地方就检测到危险，可以用来实时检测内容安全。</p><h2 id=容易忽视的关键细节>容易忽视的关键细节</h2><p>1、上来就先把safety的分类列的非常清楚，一共有几种，每一种的含义是什么，是有一句话的描述的。</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=/blogs/posts/qwen3-guard/safety_cls.png data-srcset="/blogs/posts/qwen3-guard/safety_cls.png, /blogs/posts/qwen3-guard/safety_cls.png 1.5x, /blogs/posts/qwen3-guard/safety_cls.png 2x" data-sizes=auto alt=/blogs/posts/qwen3-guard/safety_cls.png title=image.png width=780 height=585></p><p>2、在Qwen3的基础上做SFT，没有上DPO、RL。用了1.19M条训练数据。</p><p>3、数据的prompt，先是任务的描述，接着是safety policy的描述，然后是unsafe的类别列表，再然后是用户的对话，最后是输出格式上的约束。</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=/blogs/posts/qwen3-guard/prompt.png data-srcset="/blogs/posts/qwen3-guard/prompt.png, /blogs/posts/qwen3-guard/prompt.png 1.5x, /blogs/posts/qwen3-guard/prompt.png 2x" data-sizes=auto alt=/blogs/posts/qwen3-guard/prompt.png title=image.png width=1021 height=625></p><p>4、数据合成。主要用的Self-Instruct。根据safety policy构建一个taxonomy，对每一个叶子节点构造一个种子数据，让LLM扩充新的数据。</p><ul><li><p>构造了一批语义上相关的近义词，比如bomb/C4/TNT/黑火药，在合成爆炸相关的问题的时候，把这些近义词放在prompt里面，让大模型参考这些词来构造。<br><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>有点像K2-think的plan里面还要让planner提取出query中的相关的关键概念，来帮助大模型理解</div></div></div></p></li><li><p>构造了一些正负样本对，避免大模型根据一些关键词、特殊的句式来做安全性的分类。比如构造how to make a bomb和how to make a cake。<br><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>有点像path-patching的Xr和Xc</div></div></div></p></li><li><p>一般的Instruct模型已经做过安全对齐，所以很难直接生成unsafe的回答，所以让Qwen2.5-72B-Base来回答unsafe的问题。另外还额外收集了推理模型的输出。</p></li><li><p>如何标注？人工标注了一批数据，用不同模型比如Qwen2.5-72B-Instruct和Qwen3-235B-A22B来voting，在人工标注的数据集上有0.9的F1 score。</p></li><li><p>构造多语言输出。用Qwen-MT来翻译，另外专门做了翻译质量的评估，比如language mixing的检测、llm judge、以及人工随机抽检。</p></li></ul><p>5、SFT训练的挑战一个在于controversial类别的数据比较少，另一个是标注本身也有噪声。</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=/blogs/posts/qwen3-guard/data-1.png data-srcset="/blogs/posts/qwen3-guard/data-1.png, /blogs/posts/qwen3-guard/data-1.png 1.5x, /blogs/posts/qwen3-guard/data-1.png 2x" data-sizes=auto alt=/blogs/posts/qwen3-guard/data-1.png title=image.png width=1055 height=311>
<strong>怎么解决类别不均衡的问题</strong>。一个发现是训练数据本身的配比会影响模型的决策边界：safe的数据量大于unsafe的数据量会让模型的判别更松弛，更倾向于输出safe；反之则更倾向于输出unsafe。一个前提假设是controversial的数据本身就是可safe、可unsafe的，那么那些在strict和loose模型的判断之间左右横跳的数据就是controversial的数据。具体的操作是：1、把训练数据均匀分成两部分A和B。2、在A部分数据中调整safe和unsafe数据的比例训练出来两个模型，一个loose、一个strict模型。这个具体的数据配比论文里面没有讲，只是说按照validation set中最conservative（保守）和最permissive（宽容）的数据来校准。看图上差不多也就是2:8开或者3:7开，这个可以根据实际的数据分布来调整。3、让A数据训练出来的loose和strict模型对B数据进行标注voting，有分歧的数据就为controversial类别。最后放一个表格说明引入controversial类别，确实对于分类有提升。</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=/blogs/posts/qwen3-guard/data-2.png data-srcset="/blogs/posts/qwen3-guard/data-2.png, /blogs/posts/qwen3-guard/data-2.png 1.5x, /blogs/posts/qwen3-guard/data-2.png 2x" data-sizes=auto alt=/blogs/posts/qwen3-guard/data-2.png title=image.png width=951 height=322>
<strong>怎么解决数据噪声的问题</strong>。在解决了controversial类别数据量过少的问题之后，把所有的数据再分为两个部分，用一个部分的数据训练一个Qwen3-32B的模型，用这个模型对另一个部分的数据达标。这种操作可以有效的降低标注噪声。实验也证明做了蒸馏确实有提升（不到一个点）</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=/blogs/posts/qwen3-guard/data-3.png data-srcset="/blogs/posts/qwen3-guard/data-3.png, /blogs/posts/qwen3-guard/data-3.png 1.5x, /blogs/posts/qwen3-guard/data-3.png 2x" data-sizes=auto alt=/blogs/posts/qwen3-guard/data-3.png title=image.png width=1040 height=311><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>从实际操作、开发的角度来讲，这两点数据处理的trick都可以先不上，先把baseline版本搞定，然后再做针对性的提升。而且对于后面的RL 训练来说，这两个trick 没有做端到端的实验验证，所以不清楚对于最后 RL 产出的效果有多大影响。</div></div></div></p><p>6、用在RL里面。GSPO，Qwen3-4B。13.7k思考数据和6.7k的非思考数据。有两种reward的设计方式</p><ul><li><p>一种是guard-only：
<img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/45370057-7772-40f2-9769-c95add8b649e.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/45370057-7772-40f2-9769-c95add8b649e.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/45370057-7772-40f2-9769-c95add8b649e.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/45370057-7772-40f2-9769-c95add8b649e.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/45370057-7772-40f2-9769-c95add8b649e.png title=image.png></p><p>如果是guard模型输出safe奖励等于1，输出unsafe或者controversial就给0。但是这种会让模型学会拒绝回答所有的问题，因为拒绝回答肯定奖励都是1分。</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/4f580551-02e7-4bda-a2f5-2ea4da979746.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/4f580551-02e7-4bda-a2f5-2ea4da979746.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/4f580551-02e7-4bda-a2f5-2ea4da979746.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/4f580551-02e7-4bda-a2f5-2ea4da979746.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/4f580551-02e7-4bda-a2f5-2ea4da979746.png title=image.png></p></li><li><p>另一个是混合奖励：<img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/da20239e-e388-426b-87d3-494fc4dcfd62.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/da20239e-e388-426b-87d3-494fc4dcfd62.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/da20239e-e388-426b-87d3-494fc4dcfd62.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/da20239e-e388-426b-87d3-494fc4dcfd62.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/da20239e-e388-426b-87d3-494fc4dcfd62.png title=image.png></p><p>WorldPM是通义团队之前发布的一个RM，用来给helpfulness打分的。奖励大概的逻辑是：如果回答不安全，奖励只能小于等于-10，甚至如果回答既不安全又没有帮助的奖励还会比-10低。如果模型拒绝回答，奖励只能小于等于-5，而且大概率因为拒绝回答的原因WorldPM对于helpfulness打一个很低的分数，最后的奖励比-5，等于说拒绝回答的奖励也不高。如果安全并且没有拒绝回答，奖励就按照WorldPM的打分来。</p></li></ul><p>7、评估通用能力用的benchmark：Arena-Hard-v2（alignment）、AIME-25（数学）、LiveCodeBench-V6（代码）、GPQA（知识）。</p><p>8、对于训练token-level的内容安全模型来讲，最大的挑战在于token-level的标注。一共分为两步</p><ul><li><p>基于rollout的voting
<img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/edb48cb7-2467-474e-9534-1d80754f47c9.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/edb48cb7-2467-474e-9534-1d80754f47c9.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/edb48cb7-2467-474e-9534-1d80754f47c9.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/edb48cb7-2467-474e-9534-1d80754f47c9.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/edb48cb7-2467-474e-9534-1d80754f47c9.png title=image.png></p><p>对于某一个tokenSi，把Si以及之前的prefix让大模型反复采样rollout，采样后的输出让Qwen3Guard-Gen模型来分类，如果平均下来被分类为unsafe或者controversial的比例大于85%，则Si本身是一个unsafe的token。</p></li><li><p>但是，基于rollout的voting本身有一个问题在于会过度估计一些token的risk，明明这个token本身的安全的，但是由于模型本身在安全性上做的不好导致经常补全不安全的回答，造成把这个token分类为unsafe。一个补救的办法是把通过rollout报警出来的token加上他的prefix（不包括后面的补全部分），让Qwen3-235B-A22B来当LLM judge，判断这个prefix是否安全。</p></li><li><p>最终对于sampler-level的标签是unsafe或者controversial的样本来说，按照上述两个方法标注出来的token之后的token被标注为sample-evel的标签（unsafe或者controversial），之前的token被标注为safe。
<img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/2b6548f6-58f9-41a2-86ac-0214d740bc63.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/2b6548f6-58f9-41a2-86ac-0214d740bc63.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/2b6548f6-58f9-41a2-86ac-0214d740bc63.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/2b6548f6-58f9-41a2-86ac-0214d740bc63.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/2b6548f6-58f9-41a2-86ac-0214d740bc63.png title=image.png></p></li></ul><p>9、分类头的训练。一共有4个head，两个query的head，两个response的head，其中query的两个head一个用来判断safe/unsafe，一个用来判断具体的unsafe种类。</p><p><img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/bd0e7dfb-fc0e-40f2-ac7f-d618c0713195.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/bd0e7dfb-fc0e-40f2-ac7f-d618c0713195.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/bd0e7dfb-fc0e-40f2-ac7f-d618c0713195.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/bd0e7dfb-fc0e-40f2-ac7f-d618c0713195.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/bd0e7dfb-fc0e-40f2-ac7f-d618c0713195.png title=image.png></p><p>Query的loss就是两个cross-entropy loss的叠加：<img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/b5bfb1fc-a486-4e89-8700-55247bb0ec79.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/b5bfb1fc-a486-4e89-8700-55247bb0ec79.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/b5bfb1fc-a486-4e89-8700-55247bb0ec79.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/b5bfb1fc-a486-4e89-8700-55247bb0ec79.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/b5bfb1fc-a486-4e89-8700-55247bb0ec79.png title=image.png></p><p>Response的loss是所有token的cross-entropy的平均：<img class=lazyload src=/blogs/svg/loading.min.svg data-src=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/704b4322-2510-44c4-93da-b900d50d2730.png data-srcset="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/704b4322-2510-44c4-93da-b900d50d2730.png, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/704b4322-2510-44c4-93da-b900d50d2730.png 1.5x, https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/704b4322-2510-44c4-93da-b900d50d2730.png 2x" data-sizes=auto alt=https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952yojkaNlap/img/704b4322-2510-44c4-93da-b900d50d2730.png title=image.png></p><p>另外还有一个技巧是：q-cat和r-cat loss本身是有条件的，只有在risk的标注是unsafe或者controversial的时候才会把q-cat和r-cat loss参与计算loss，如果是safe的情况下就忽略。</p><h2 id=insight>Insight</h2><ol><li><p>一些分类的小模型的训练方法中可以看到一些机器学习的影子，ensemble、voting、蒸馏、cross-validation，基本上用一些机器学习的技巧就差不多了。</p></li><li><p>对于蒸馏来讲，一些分类的小模型Qwen3-32B就可以作为teacher模型了。</p></li><li><p>对于token-level的标注也很有意思，既有neel nanda那个CoT可解释性工作的影子，也结合了LLM来二次判断。</p></li><li><p>这种专项小模型的训练过程中，大规模使用LLM来做数据处理是必然。</p></li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-09-29</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=x data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-title=Qwen3Guard的关键技术细节 data-via=https://twitter.com/yourname data-hashtags=Qwen><i class="fab fa-x-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Threads" data-sharer=threads data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-title=Qwen3Guard的关键技术细节><i class="fab fa-threads fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-hashtag=Qwen><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-title=Qwen3Guard的关键技术细节><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-title=Qwen3Guard的关键技术细节><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-title=Qwen3Guard的关键技术细节><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Diaspora" data-sharer=diaspora data-url=https://yellowtownhz.github.io/blogs/zh/posts/qwen3-guard/ data-title=Qwen3Guard的关键技术细节 data-description=这是一篇中文翻译。><i class="fab fa-diaspora fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fyellowtownhz.github.io%2fblogs%2fzh%2fposts%2fqwen3-guard%2f&amp;text=Qwen3Guard%e7%9a%84%e5%85%b3%e9%94%ae%e6%8a%80%e6%9c%af%e7%bb%86%e8%8a%82" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/blogs/zh/tags/qwen/>Qwen</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/blogs/zh/>Home</a></span></section></div><div class=post-nav></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.150.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/blogs/zh/ target=_blank>xxxx</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script>window.config={comment:{},search:{highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30}}</script><script src=/blogs/js/theme.min.js></script></body></html>